<%- include('../layouts/header.ejs') %>
    <%- include('../layouts/commonhead.ejs',{session}) %>

        <style>
            /* Styles for desktop and larger screens */
            .shop__sidebar {
                display: flex;
                flex-direction: column;
                width: 75%;
                margin-right: 2rem;
            }

            .sidebar__categories,
            .sidebar__filter,
            .sidebar__sizes {
                margin-bottom: 2rem;
            }

            .section-title {
                margin-bottom: 10px !important;
            }

            .categories__accordion {
                margin-left: 25px;
            }

            .card {
                border: none;
                background-color: transparent;
            }

            .list {
                list-style: none;
                margin: 0;
                padding: 0;
            }

            .list li {
                margin-bottom: 0.5rem;
            }

            .list li label {
                display: flex;
                align-items: center;
            }

            .list li label input {
                margin-right: 0.5rem;
            }

            /* Styles for smaller screens */
            @media screen and (max-width: 768px) {
                .shop__sidebar {
                    width: 100%;
                    margin-right: 0;
                }
            }
        </style>


        <!-- Page Preloder -->
        <div id="preloder">
            <div class="loader"></div>
        </div>


        <section class="breadcrumb-option">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="breadcrumb__text">
                            <h4>Product View</h4>
                            <div class="breadcrumb__links">
                                <a href="/">Home</a>
                                <a href="/shopPage">Shop</a>
                                <span>Product View</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Shop Section Begin -->
        <section class="shop spad">
            <div class="container">
                <div class="row">

                    <div class="col-lg-3">
                        <div class="left_sidebar_area">

                            <div class="col-lg-12 col-md-12">
                                <div class="shop__sidebar ">
                                    <div class="sidebar__sizes">
                                        <div class="section-title d-flex justify-content-start">
                                            <div class="">
                                                <h4>Categories</h4>
                                            </div>
                                        </div>
                                        <%category.forEach(element=> {%>
                                            <div class="d-flex justify-content-between">
                                                <div class="">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox"
                                                            onclick="category('<%=element.category%>')"
                                                            name="<%=element.category%>" id="<%=element.category%>"
                                                            value="<%=element.category%>">
                                                        <label class="form-check-label" for="<%=element.category%>">
                                                            <%=element.category%>
                                                        </label>

                                                    </div>
                                                </div>
                                            </div>

                                            <%})%>
                                    </div>
                                    <div class="sidebar__sizes">
                                        <div class="section-title d-flex justify-content-start">
                                            <div>
                                                <h4>Shop by price</h4>
                                            </div>
                                        </div>
                                        <style>
                                            .flex-container {
                                                display: flex;
                                                flex-direction: column;
                                                align-items: flex-start;
                                            }
                                        </style>

                                        <div class="flex-container">
                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <input onclick="price(4)" type="checkbox" value="5000" id="FOUR">
                                                </div>
                                                <div>
                                                    <label for="FOUR">
                                                        5000-above
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <input onclick="price(3)" type="checkbox" value="2000,4999"
                                                        id="THREE">
                                                </div>
                                                <div>
                                                    <label for="THREE">
                                                        2000-4999
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <input onclick="price(2)" type="checkbox" value="1000,1999"
                                                        id="TWO">
                                                </div>
                                                <div>
                                                    <label for="TWO">
                                                        1000-1999
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="d-flex justify-content-between">
                                                <div>
                                                    <input onclick="price(1)" type="checkbox" value="0,999" id="ONE">
                                                </div>
                                                <div>
                                                    <label for="ONE">
                                                        0-999
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                </div>
                            </div>


                        </div>
                    </div>
                    <!--ghth-->
                    <div class="col-lg-9">
                        <div class="shop__product__option">
                            <div class="row justify-content-end">
                                <!-- <div class="col-lg-6 col-md-6 col-sm-6">
                                            <div class="shop__product__option__left"> -->
                                <!-- <p>Showing 1â€“12 of 126 results</p> -->
                                <!-- </div>
                                        </div> -->
                                <form action="#">
                                    <input onkeyup="filtersearch()" id="search" type="text" placeholder="Search...">
                                    <button type="submit"><span class="icon_search"></span></button>
                                </form>
                                <div class="col-lg-6 col-md-6 col-sm-6">
                                    <div class="shop__product__option__right">
                                        <p>Sort by Price:</p>
                                        <select onchange="sortProducts()">>
                                            <option value="LtoH" id="low">Low To High</option>
                                            <option value="HtoL" id="high">High To Low</option>

                                        </select>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="Filter" class="row">
                            <% product.forEach(item=>{%>
                                <div class="col-lg-4 col-md-6 col-sm-6">
                                    <a href="/productView?id=<%=item._id%>">
                                        <div class="product__item">
                                            <div class="product__item__pic set-bg d-flex justify-content-center"
                                                data-setbg="">
                                                <img class="product__item__pic set-bg  "
                                                    src="/proImage/<%=item.image[0]%>" alt="">

                                                <ul class="product__hover">
                                                    <div>
                                                        <li>
                                                            <form action="/addingTOWishlist?id=<%=item._id%>"
                                                                method="post"><button style="border-color: transparent;"
                                                                    type="submit"> <img src="img/icon/heart.png"
                                                                        alt=""></button></form>
                                                        </li>
                                                    </div>

                                                    <li>
                                                        <form action="/addToCart?id=<%=item._id%>" method="post"><button
                                                                style="border-color: transparent;" type="submit"><img
                                                                    src="/img/icon/cart.png" alt=""></button></form>
                                                    </li>

                                                </ul>

                                            </div>

                                            <div class="product__item__text">
                                                <% const stock=item.stock %>
                                                    <% let message=stock> 0 ? null : 'Product is out of stock.'; %>
                                                        <h6 class="text-danger mt-0  fontsize">
                                                            <%= message %>
                                                        </h6>
                                                        <h6><%- item.title %></h6>

                                                        <div class="rating">
                                                            <i class="fa fa-star-o"></i>
                                                            <i class="fa fa-star-o"></i>
                                                            <i class="fa fa-star-o"></i>
                                                            <i class="fa fa-star-o"></i>
                                                            <i class="fa fa-star-o"></i>
                                                        </div>
                                                        <h5>Rs.<%- item.price %></h5>
                                                        <!-- <div class="product__color__select">
                                                            <label for="pc-4">
                                                                <input type="radio" id="pc-4">
                                                            </label>
                                                            <label class="active black" for="pc-5">
                                                                <input type="radio" id="pc-5">
                                                            </label>
                                                            <label class="grey" for="pc-6">
                                                                <input type="radio" id="pc-6">
                                                            </label>
                                                        </div> -->
                                            </div>
                                        </div>
                                    </a>
                                </div>

                                <% }) %>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="product__pagination">
                                                <!-- ///pagination//// -->

                                                <%for(let j=1;j<=totalPages;j++){%>
                                                    <%if(totalPages>1){%>


                                                        <a class="active" href="?page=<%=j%>">
                                                            <%=j%>
                                                        </a>
                                                        <%}%>
                                                            <%}%>

                                            </div>
                                        </div>
                                    </div>
                        </div>
                    </div>

                </div>

            </div>
            </div>
        </section>

        </div>


        <%if(msg!=null){%>
            <script>
                new Swal({
                    title: "Error",
                    text: "<%=msg%>",
                    icon: "error",
                    showConfirmButton: false,
                    timer: 2000
                });
            </script>
            <%}%>

                <script>
                    let n = 0
                    let b = 0
                    let categorys = []
                    let search
                    let prices = []
                    let filterprice = []
                    let sort
                    function category(ID) {


                        if ($(`#${ID}`).is(':checked') == true) {
                            categorys[n] = $(`#${ID}`).val()
                            n++
                        } else {
                            let index = categorys.indexOf(`${$(`#${ID}`).val()}`)
                            categorys.splice(index, 1)
                            n--
                        }
                        submit(search, categorys, filterprice, sort)

                    }

                    function submit(search, categorys, filterprice, sort) {
                        $.ajax({
                            url: '/shopFilter',
                            type: 'post',
                            dataType: 'json',
                            contentType: 'application/json',
                            data: JSON.stringify({ search, categorys, filterprice, sort }),
                            success: (res) => {

                                let html = []
                                if (res.Data) {

                                    $('#Filter').html('')
                                    res.Data.forEach(value => {
                                        value.forEach((item, i) => {
                                            html += `<div class="col-lg-4 col-md-6 col-sm-6">
                                                <a href="/productView?id=${item._id}">
                                                    <div class="product__item">
                                                        <div class="product__item__pic set-bg d-flex justify-content-center"
                                                            data-setbg="img/product/product-2.jpg">
                                                            <img src="/proImage/${item.image[0].toString('utf8')}" alt="">
                                                            <ul class="product__hover">
                                                              
                                                                <div>
                                                                    <form
                                                                        action="/addingTOWishlist?id=${item._id}"
                                                                        method="post">
                                                                        <li class=""><button
                                                                                style="border-color: transparent;"
                                                                                type="submit"> <img
                                                                                    src="img/icon/heart.png"
                                                                                    alt=""></button></li>
                                                                    </form>
                                                                    
                                                                </div>
                                                                <form action="/addToCart?id=${item._id}"
                                                                    method="post">
                                                                    <li><button style="border-color: transparent;"
                                                                            type="submit"><img src="/img/icon/cart.png"
                                                                                alt=""></button></li>
                                                                </form>
                                                              
                                                            </ul>
                                                            
                                                        </div>
                                                        
                                                        <div class="product__item__text">
                                                            <h6>${item.title}</h6>

                                                            <div class="rating">
                                                                <i class="fa fa-star-o"></i>
                                                                <i class="fa fa-star-o"></i>
                                                                <i class="fa fa-star-o"></i>
                                                                <i class="fa fa-star-o"></i>
                                                                <i class="fa fa-star-o"></i>
                                                            </div>
                                                            <h5>Rs.${item.price}</h5>
                                                            
                                                        </div>
                                                    </div>
                                                </a>
                                            </div> `

                                        })

                                    });

                                    $('#Filter').html(html)

                                }
                            }
                        })
                    }

                    function filtersearch() {
                        search = $('#search').val()
                        submit(search, categorys, filterprice, sort)
                    }




                    function price(check) {
                        filterprice = []
                        let one, two, three, four
                        let n = 0, index
                        if ($("#ONE").is(':checked') == true) {
                            one = $("#ONE").val()
                            prices[n] = one
                            n++
                        } else if (check == 1) {
                            index = prices.indexOf($("#ONE").val())
                            prices.splice(index, 1)

                        }
                        if ($("#TWO").is(':checked') == true) {
                            two = $("#TWO").val()
                            prices[n] = two
                            n++
                        } else if (check == 2) {
                            index = prices.indexOf($("#TWO").val())
                            prices.splice(index, 1)

                        }
                        if ($("#THREE").is(':checked') == true) {
                            three = $("#THREE").val()
                            prices[n] = three
                            n++
                        } else if (check == 3) {
                            index = prices.indexOf($("#THREE").val())
                            prices.splice(index, 1)

                        }
                        if ($("#FOUR").is(':checked') == true) {
                            four = $("#FOUR").val()
                            prices[n] = four
                            n++
                        } else if (check == 4) {
                            index = prices.indexOf($("#FOUR").val())
                            prices.splice(index, 1)

                        }
                        let length
                        if (prices) {
                            length = prices.length
                        }

                        //    console.log(prices[length-1].split(',').length)
                        if (prices.length == 1 && prices[length - 1].split(',').length == 2) {
                            let first = [prices[length - 1]]
                            first = first[0].split(',')

                            filterprice[0] = first[0]
                            filterprice[1] = first[1]

                        } else if (prices.length == 1 && prices[length - 1].split(',').length == 1) {

                            let first = []
                            first[0] = prices[0]
                            filterprice[0] = first[0]

                        } else if (prices.length > 1 && prices[length - 1].split(',').length == 2) {
                            let first = [prices[0]]
                            let second = [prices[length - 1]]
                            first = first[0].split(',')
                            second = second[0].split(',')
                            filterprice[0] = first[0]
                            filterprice[1] = second[1]

                        } else if (prices.length > 1 && prices[length - 1].split(',').length == 1) {
                            let first = [prices[0]]
                            first = first[0].split(',')
                            filterprice[0] = first[0]

                        }
                        submit(search, categorys, filterprice, sort)
                    }
                    function sortProducts() {
                        let selectedSort = document.querySelector('select').value;
                        if (selectedSort === 'LtoH') {
                            sort = 'priceLowToHigh';
                        } else if (selectedSort === 'HtoL') {
                            sort = 'priceHighToLow';
                        }
                        submit(search, categorys, filterprice, sort);
                    }

                </script>

                <%- include('../layouts/commonfooter.ejs',{session}) %>
                <%- include('../layouts/footer.ejs') %>